<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Intentionally Vulnerable Test App</title>
    <!-- VULNERABILITY: Missing Content-Security-Policy -->
    <!-- VULNERABILITY: Missing X-Frame-Options (handled by server headers) -->
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .warning {
        background: #fff3cd;
        border: 2px solid #ffc107;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
      }
      .section {
        background: white;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      input,
      textarea {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="warning">
      <strong>⚠️ WARNING:</strong> This is an intentionally vulnerable test
      application. DO NOT deploy to production. For security testing purposes
      only.
    </div>

    <h1>Vulnerable Test Application</h1>
    <p>
      This page contains intentional security vulnerabilities for testing
      WebSecScan.
    </p>

    <!-- VULNERABILITY 1: Form without HTTPS and missing action -->
    <div class="section">
      <h2>1. Insecure Login Form</h2>
      <form method="POST">
        <input type="text" name="username" placeholder="Username" required />
        <input
          type="password"
          name="password"
          placeholder="Password"
          required
        />
        <button type="submit">Login</button>
      </form>
    </div>

    <!-- VULNERABILITY 2: Form with HTTP action -->
    <div class="section">
      <h2>2. Form with HTTP Action</h2>
      <form action="http://example.com/submit" method="POST">
        <input type="email" name="email" placeholder="Email" required />
        <button type="submit">Submit</button>
      </form>
    </div>

    <!-- VULNERABILITY 3: XSS via innerHTML -->
    <div class="section">
      <h2>3. Reflected XSS Test</h2>
      <input type="text" id="userInput" placeholder="Enter some text" />
      <button onclick="displayInput()">Display</button>
      <div id="output"></div>
    </div>

    <!-- VULNERABILITY 4: Inline script without nonce -->
    <script>
      // VULNERABILITY: Inline script without CSP nonce

      // VULNERABILITY: Use of eval()
      function unsafeEval(code) {
        return eval(code); // Dangerous: arbitrary code execution
      }

      // VULNERABILITY: Unsafe innerHTML usage
      function displayInput() {
        const input = document.getElementById("userInput").value;
        document.getElementById("output").innerHTML = input; // XSS vulnerability
      }

      // VULNERABILITY: Hardcoded API key
      const API_KEY = "sk_live_abcdef123456789_SECRET_KEY"; // Never hardcode secrets!
      const DATABASE_PASSWORD = "admin123"; // Hardcoded password

      // VULNERABILITY: Use of new Function()
      function dynamicFunction(userCode) {
        const fn = new Function("x", userCode); // Code injection risk
        return fn;
      }

      // Simulate setting insecure cookie (would be done server-side normally)
      document.cookie = "session=abc123; path=/"; // Missing Secure and HttpOnly flags

      console.log("Vulnerable app loaded");
    </script>

    <!-- VULNERABILITY 5: External script loaded over HTTP -->
    <!-- Commented out to avoid actual HTTP request in tests -->
    <!-- <script src="http://example.com/script.js"></script> -->

    <div class="section">
      <h2>4. User Comments</h2>
      <textarea id="comment" placeholder="Leave a comment"></textarea>
      <button onclick="postComment()">Post Comment</button>
      <div id="comments"></div>
    </div>

    <script>
      // VULNERABILITY: More innerHTML usage
      function postComment() {
        const comment = document.getElementById("comment").value;
        const commentsDiv = document.getElementById("comments");
        commentsDiv.innerHTML += "<p>" + comment + "</p>"; // XSS vulnerability
      }

      // VULNERABILITY: Using dangerouslySetInnerHTML pattern (simulated for React)
      // In React: <div dangerouslySetInnerHTML={{__html: userContent}} />
    </script>

    <div class="section">
      <h2>5. URL Parameter Reflection</h2>
      <p>Your search query: <span id="searchQuery"></span></p>
    </div>

    <script>
      // VULNERABILITY: Reflected XSS from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get("q");
      if (query) {
        document.getElementById("searchQuery").innerHTML = query; // Reflected XSS
      }

      // VULNERABILITY: More dangerous patterns
      const userScript = "console.log('test')";
      eval(userScript); // eval with user input

      // VULNERABILITY: window.location manipulation
      function redirect(url) {
        window.location = url; // Open redirect vulnerability if url comes from user
      }
    </script>

    <div class="section">
      <h2>6. Image Upload Preview</h2>
      <input type="file" id="imageUpload" accept="image/*" />
      <div id="imagePreview"></div>
    </div>

    <script>
      // VULNERABILITY: Unsafe file handling
      document
        .getElementById("imageUpload")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
              // VULNERABILITY: innerHTML with user-controlled content
              document.getElementById("imagePreview").innerHTML =
                '<img src="' + event.target.result + '" width="200">'; // Potential XSS
            };
            reader.readAsDataURL(file);
          }
        });
    </script>

    <footer class="section">
      <p>This test fixture contains the following vulnerabilities:</p>
      <ul>
        <li>Missing Content-Security-Policy header</li>
        <li>Inline scripts without nonce</li>
        <li>Use of eval() and Function() constructor</li>
        <li>Unsafe innerHTML usage (XSS)</li>
        <li>Hardcoded secrets (API keys, passwords)</li>
        <li>Forms without action or with HTTP action</li>
        <li>Reflected XSS from URL parameters</li>
        <li>Insecure cookie configuration</li>
        <li>
          Missing security headers (X-Frame-Options, X-Content-Type-Options,
          etc.)
        </li>
      </ul>
    </footer>
  </body>
</html>
